const BASE_URL=window.location.origin,GLOSSARY_CACHE_KEY="glossaryCache",GLOSSARY_CACHE_LAST_FETCH_KEY="glossaryCacheLastFetch";async function fetchGlossaryData(){const s=Date.UTC(2024,10,23,23,29,0),o=(new Date).getTime(),e=localStorage.getItem(GLOSSARY_CACHE_KEY),t=localStorage.getItem(GLOSSARY_CACHE_LAST_FETCH_KEY);if(environment==="production"&&e&&t&&parseInt(t)>s)return JSON.parse(e);const i=await fetch("/data/glossary.json"),n=await i.json();return localStorage.setItem(GLOSSARY_CACHE_KEY,JSON.stringify(n)),localStorage.setItem(GLOSSARY_CACHE_LAST_FETCH_KEY,o),n}function getDefinition(e,t){return t[e.toLowerCase()]}function processGlossaryDefinitionText(e,t,n,s){let o=-1;const i=new RegExp('\\{\\{\\s*?<\\s*?glossary term="?([^"\\s]+?)"?(?:\\s+?displayTerm="?((?:(?!"?\\s+?>\\s*?\\}\\}).)+)"?)?\\s*?>\\s*?\\}\\}',"g");n=n.replace(i,(n,i,a)=>{o=o+1;const c=getDefinition(i,s),r=(a||i).trim();return`
            <span
                class="glossary-term" glossary-data-tree-id="${e}"
                glossary-data-tree-node-id="${t},${o}"
                glossary-data-term="${i}
                onclick="fetchAndRenderGlossaryDefinition(this)
            ">
                ${r}
            </span>
        `.trim()});const a=new RegExp('\\[([^\\]]+?)\\]\\(\\s*?\\{\\{\\s*?%\\s*?ref\\s+?\\"?([^\\"\\s]+?)\\"?\\s*?%\\s*?}}\\s*?\\)',"g");n=n.replace(a,(e,t,n)=>{const s=t||n;return n=n.split("").filter(e=>!["(",")"].includes(e)).join(""),n.startsWith("/")||(n="/"+n),`<a href="${BASE_URL+n}" target="_blank" rel="noopener">${s}</a>`});const r=new RegExp("\\*\\*([^**]+?)\\*\\*","g");n=n.replace(r,"<strong>$1</strong>");const c=new RegExp("\\{\\{\\s*?<\\s*?hr\\s*?>\\s*?\\}\\}");n=n.replace(c,'<br><svg height="2" width="100%"><line x1="0" y1="0" x2="100%" y2="0" style="stroke:#ccc;stroke-width:2"/></svg><br>');const l=new RegExp("\\{\\{\\s*?<\\s*?hr-span\\s*?>\\s*?\\}\\}");return n=n.replace(l,'<span style="display: block; width: 100%; height: 1px; background-color: rgb(30, 30, 30); margin: 0.5rem 0;"></span>'),n}function isModalOpen(e,t){const n=document.querySelectorAll(`[m-glossary-data-tree-id="${e}"]`);return Array.from(n).some(e=>e.getAttribute("m-glossary-data-tree-node-id")===t)}function prepareModal(e,t,n,s,o,i){e.classList.add("glossary-modal"),e.setAttribute("style",`max-width: ${n?"100vw":"300px"}`),e.setAttribute("m-glossary-data-tree-id",s),e.setAttribute("m-glossary-data-tree-node-id",o),e.innerHTML=`
        <div class="glossary-modal-header">
            <h5 class="glossary-modal-title">${t}</h5>
            <div class="glossary-modal-close" onclick="closeGlossaryModal(this)">&times;</div>
        </div>
        <p class="glossary-modal-content">${i}</p>
    `}function positionModal(e,t,n){const o=n.getBoundingClientRect(),i=e?window.innerWidth:300;let a=o.bottom+window.scrollY,s;if(e)s=0;else{const e=window.innerWidth-o.right;s=o.left+window.scrollX,e<i&&(s=Math.max(0,window.innerWidth-i-20))}t.style.top=`${a}px`,t.style.left=`${s}px`}async function fetchAndRenderGlossaryDefinition(e){const t=e.getAttribute("glossary-data-term"),i=t.startsWith("diag-"),n=e.getAttribute("glossary-data-tree-id"),s=e.getAttribute("glossary-data-tree-node-id");if(isModalOpen(n,s))return;const a=await fetchGlossaryData();let r=getDefinition(t,a);if(!r){showAlert("Definition not found!");return}const c=processGlossaryDefinitionText(n,s,r,a),o=document.createElement("div");prepareModal(o,t,i,n,s,c),positionModal(i,o,e),document.body.appendChild(o)}function getChildrenGlossaryModals(e){let t=[];const n=e.getAttribute("m-glossary-data-tree-id"),s=document.querySelectorAll(`[m-glossary-data-tree-id="${n}"]`),o=e.getAttribute("m-glossary-data-tree-node-id");return t=Array.from(s).filter(e=>e.getAttribute("m-glossary-data-tree-node-id").startsWith(o)),t.push(e),t}function closeGlossaryModal(e){e.classList.contains("glossary-modal-close")&&(e=e.closest(".glossary-modal"));const t=getChildrenGlossaryModals(e);t.forEach(e=>e.remove())}setTimeout(()=>{window.addEventListener("click",function(t){for(var n,s,i=document.getElementsByClassName("glossary-term"),o=0;o<i.length;o++)if(t.target===i[o])return;for(n=document.getElementsByClassName("glossary-modal"),s=0;s<n.length;s++)if(n[s].contains(t.target))return;if(t.target.classList.contains("glossary-modal-close"))return;Array.from(n).forEach(e=>e.remove())})},0);function showAlert(e){const t=document.createElement("div");t.textContent=e,t.style.position="fixed",t.style.top="10px",t.style.left="10%",t.style.width="80%",t.style.backgroundColor="#ffcccc",t.style.color="#990000",t.style.padding="10px",t.style.textAlign="center",t.style.fontWeight="500",t.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",t.style.zIndex="1000",document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}